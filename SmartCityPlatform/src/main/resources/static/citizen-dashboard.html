<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VatandaÅŸ Paneli - AkÄ±llÄ± Åehir Platformu</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h2>ğŸ™ï¸ AkÄ±llÄ± Åehir Platformu</h2>
            <div class="nav-user">
                <span id="userName">KullanÄ±cÄ±</span>
                <button onclick="logout()" class="btn btn-secondary">Ã‡Ä±kÄ±ÅŸ</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard">
            <aside class="sidebar">
                <h3>MenÃ¼</h3>
                <ul class="menu">
                    <li><a href="#" onclick="showSection('createIssue')" class="menu-item active">ğŸ“ Yeni Åikayet</a></li>
                    <li><a href="#" onclick="showSection('myIssues')" class="menu-item">ğŸ“‹ Åikayetlerim</a></li>
                    <li><a href="#" onclick="showSection('projects')" class="menu-item">ğŸ—ï¸ AÃ§Ä±k Projeler</a></li>
                    <li><a href="#" onclick="showSection('applications')" class="menu-item">ğŸ“© BaÅŸvurularÄ±m</a></li>
                </ul>
            </aside>

            <main class="main-content">
                <!-- Create Issue Section -->
                <section id="createIssue" class="content-section active">
                    <h2>Yeni Åikayet/Talep OluÅŸtur</h2>
                    <form id="createIssueForm" class="form-card">
                        <div class="form-group">
                            <label for="issueTitle">BaÅŸlÄ±k</label>
                            <input type="text" id="issueTitle" required placeholder="Åikayet baÅŸlÄ±ÄŸÄ±nÄ± giriniz">
                        </div>
                        <div class="form-group">
                            <label for="issueCategory">Kategori</label>
                            <select id="issueCategory" required>
                                <!-- Kategoriler JavaScript ile dinamik olarak yÃ¼klenecek -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="issueDescription">AÃ§Ä±klama</label>
                            <textarea id="issueDescription" rows="5" required placeholder="Åikayetinizi detaylÄ± olarak aÃ§Ä±klayÄ±nÄ±z"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Åikayeti GÃ¶nder</button>
                    </form>
                </section>

                <!-- My Issues Section -->
                <section id="myIssues" class="content-section">
                    <h2>Åikayetlerim</h2>
                    <div class="filter-section">
                        <label>Durum Filtresi:</label>
                        <select id="statusFilter" onchange="loadMyIssues()">
                            <option value="">TÃ¼mÃ¼</option>
                            <option value="Yeni">Yeni</option>
                            <option value="Ä°nceleniyor">Ä°nceleniyor</option>
                            <option value="Ã‡Ã¶zÃ¼ldÃ¼">Ã‡Ã¶zÃ¼ldÃ¼</option>
                        </select>
                    </div>
                    <div id="issuesList" class="cards-container"></div>
                </section>

                <!-- Projects Section -->
                <section id="projects" class="content-section">
                    <h2>AÃ§Ä±k Projeler</h2>
                    <div id="projectsList" class="cards-container"></div>
                </section>

                <!-- Applications Section -->
                <section id="applications" class="content-section">
                    <h2>BaÅŸvurularÄ±m</h2>
                    <div id="applicationsList" class="cards-container"></div>
                </section>
            </main>
        </div>
    </div>

    <div id="message" class="message"></div>

    <!-- Application Modal -->
    <div id="applicationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeApplicationModal()">&times;</span>
            <h2>Projeye BaÅŸvur</h2>
            <p><strong>Proje:</strong> <span id="modalProjectTitle"></span></p>
            <div class="form-group">
                <label for="applicationNotes">BaÅŸvuru Notunuz (Opsiyonel)</label>
                <textarea id="applicationNotes" rows="4" placeholder="BaÅŸvurunuz hakkÄ±nda ek bilgi ekleyebilirsiniz..."></textarea>
            </div>
            <div class="modal-actions">
                <button onclick="closeApplicationModal()" class="btn btn-secondary">Ä°ptal</button>
                <button onclick="submitApplication()" class="btn btn-primary">BaÅŸvur</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let categories = [];

        // Check authentication on load
        window.onload = function() {
            const user = localStorage.getItem('user');
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            currentUser = JSON.parse(user);
            document.getElementById('userName').textContent = currentUser.fullName;
            loadCategories();
            loadMyIssues();
            loadProjects();
            loadApplications();
        };

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            // Show selected section
            document.getElementById(sectionId).classList.add('active');
            
            // Update menu active state
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // EÄŸer "Yeni Åikayet" bÃ¶lÃ¼mÃ¼ne geÃ§iliyorsa ve kategoriler yÃ¼klenmemiÅŸse yÃ¼kle
            if (sectionId === 'createIssue' && !categoriesLoaded) {
                loadCategories();
            }
            
            // EÄŸer "Åikayetlerim" bÃ¶lÃ¼mÃ¼ne geÃ§iliyorsa ÅŸikayetleri yÃ¼kle
            if (sectionId === 'myIssues') {
                loadMyIssues();
            }
            
            // EÄŸer "AÃ§Ä±k Projeler" bÃ¶lÃ¼mÃ¼ne geÃ§iliyorsa projeleri yÃ¼kle
            if (sectionId === 'projects') {
                loadProjects();
            }
            
            // EÄŸer "BaÅŸvurularÄ±m" bÃ¶lÃ¼mÃ¼ne geÃ§iliyorsa baÅŸvurularÄ± yÃ¼kle
            if (sectionId === 'applications') {
                loadApplications();
            }
        }

        function logout() {
            localStorage.removeItem('user');
            window.location.href = 'index.html';
        }
    </script>
    <script src="js/api.js"></script>
    <script src="js/citizen.js"></script>
</body>
</html>

